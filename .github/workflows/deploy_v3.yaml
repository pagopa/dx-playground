name: Deploy Azure Function V3

on:
  workflow_dispatch:
  push:
    tags:
      - "azure-function-v3@[0-9]+.[0-9]+.[0-9]+"

permissions:
  contents: read
  id-token: write
  attestations: write
  packages: write

jobs:
  deploy:
    name: Deploy Azure Function V3
    concurrency:
      group: ${{ github.workflow }}-cd
      # Override this configuration to prevent cancelling a running deploy.
      cancel-in-progress: false
    # uses: pagopa/dx/.github/workflows/release-azure-containerapp-v1.yaml@feats/unify-incremental-rollout-apis
    # uses: pagopa/dx/.github/workflows/web_app_deploy.yaml@fix-code-injection-actions
    uses: pagopa/dx/.github/workflows/web_app_deploy.yaml@main
    secrets: inherit
    with:
      # dockerfile_path: apps/azure-function-v3/Dockerfile
      # docker_image_name: pagopa/dx-azure-function-v3
      # docker_image_description: "Azure Function V3 for DX Playground"
      # docker_image_authors: "DevX Team"
      # container_app: dx-d-itn-func-ca-01
      # resource_group_name: dx-d-itn-workflow-test-rg-01
      # environment: app-dev
      workspace_name: azure-function-v3
      environment: app-dev
      resource_group_name: dx-d-itn-test-rg-01
      web_app_name: dx-d-itn-playground-v3-func-01
      use_private_agent: true
      use_staging_slot: false
