name: Convert dot to Mermaid with Ollama

# Ref. https://github.com/ai-action/setup-ollama
# Ref. https://github.com/ollama/ollama?tab=readme-ov-file#model-library

on:
  workflow_dispatch:

jobs:
  dot-to-mermaid:
    runs-on: ubuntu-latest
    permissions:
      models: read
      contents: read
    steps:
      - name: Checkout PR
        uses: actions/checkout@v4

      - name: Setup Ollama
        uses: ai-action/setup-ollama@v1

      - name: Call AI model
        run: |
          ollama run llama3.2 '
          Convert Terraform-generated Graphviz DOT diagrams into clear, human-friendly Mermaid diagrams.
          Here is the DOT code to convert:
          \`\`\`dot
          $(cat ./infra/resources/dev/graph.dot)
          \`\`\`
          ' > mermaid_results.txt

          cat mermaid_results.txt

      - name: Upload Artifact
        uses: actions/upload-artifact@0b2256b8c012f0828dc542b3febcab082c67f72b # v4.3.4
        with:
          name: "bundle-mermaid"
          path: mermaid_results.txt
          if-no-files-found: error
          retention-days: 7